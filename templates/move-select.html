<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>è¡Œå‹•é¸æŠ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reset.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/move-select.css') }}">
    <!-- DotGothic16ãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="background"></div> <!-- èƒŒæ™¯ç”¨ã®è¦ç´  -->

        <div class="button-container">
            <button class="movement-button attack-button" onclick="selectMovement('attack')">ãŸãŸã‹ã†</button>
            <button class="movement-button item-button" onclick="selectMovement('item')">ã‚¢ã‚¤ãƒ†ãƒ </button>
        </div>
    </div>

    <!-- ã‚¢ã‚¤ãƒ†ãƒ é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="item-modal" id="itemModal">
        <div class="item-window">
            <button class="close-button" onclick="closeItemModal()">&times;</button>
            <div class="item-header">ã‚¢ã‚¤ãƒ†ãƒ ã‚’é¸æŠ</div>

            <div class="item-grid" id="itemGrid">
                <!-- ã‚¢ã‚¤ãƒ†ãƒ ã‚¹ãƒ­ãƒƒãƒˆãŒJavaScriptã§ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>

            <button class="cancel-button" onclick="closeItemModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <!-- ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="use-confirm" id="useConfirm">
        <div class="confirm-window">
            <div class="confirm-text" id="confirmText"></div>
            <div class="confirm-buttons">
                <button class="confirm-button confirm-yes" onclick="confirmUse(true)">ã¯ã„</button>
                <button class="confirm-button confirm-no" onclick="confirmUse(false)">ã„ã„ãˆ</button>
            </div>
        </div>
    </div>

    <script>
        // ã‚µãƒ³ãƒ—ãƒ«ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã¯ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å–å¾—ï¼‰
        const playerItems = [
            { id: 1, name: 'ã‹ã„ãµãè–¬', icon: 'ğŸ§ª', count: 3, effect: 'HPå›å¾©' },
            { id: 2, name: 'ãƒãƒŠãƒãƒ¼ã‚·ãƒ§ãƒ³', icon: 'ğŸ’™', count: 2, effect: 'MPå›å¾©' },
            { id: 3, name: 'æ¯’æ¶ˆã—', icon: 'ğŸ€', count: 1, effect: 'æ¯’çŠ¶æ…‹å›å¾©' },
            { id: 4, name: 'æ”»æ’ƒã®æ›¸', icon: 'ğŸ“œ', count: 1, effect: 'æ”»æ’ƒåŠ›ã‚¢ãƒƒãƒ—' },
            { id: 5, name: 'å®ˆã‚Šã®ç›¾', icon: 'ğŸ›¡ï¸', count: 2, effect: 'é˜²å¾¡åŠ›ã‚¢ãƒƒãƒ—' },
            // ç©ºã®ã‚¹ãƒ­ãƒƒãƒˆç”¨ã®nullã‚’è¿½åŠ 
            null
        ];

        let selectedItem = null;

        function selectMovement(movement) {
            console.log('é¸æŠã•ã‚ŒãŸè¡Œå‹•:', movement);

            if (movement === 'item') {
                showItemModal();
            } else {
                // å¾“æ¥ã®å‡¦ç†
                const movementNames = {
                    'attack': 'ãŸãŸã‹ã†'
                };

                if (confirm(movementNames[movement] + 'ã§ã„ã„ï¼Ÿ')) {
                    window.location.href = '/question/' + movement;
                }
            }
        }

        function showItemModal() {
            const modal = document.getElementById('itemModal');
            const itemGrid = document.getElementById('itemGrid');

            // ã‚¢ã‚¤ãƒ†ãƒ ã‚°ãƒªãƒƒãƒ‰ã‚’ã‚¯ãƒªã‚¢
            itemGrid.innerHTML = '';

            // 6å€‹ã®ã‚¹ãƒ­ãƒƒãƒˆã‚’ä½œæˆï¼ˆ3Ã—2ã®ã‚°ãƒªãƒƒãƒ‰ï¼‰
            for (let i = 0; i < 6; i++) {
                const item = playerItems[i];
                const slot = document.createElement('div');
                slot.className = 'item-slot';

                if (item) {
                    slot.innerHTML = `
                        <div class="item-icon">${item.icon}</div>
                        <div class="item-count">Ã—${item.count}</div>
                        <div class="item-name">${item.name}</div>
                    `;
                    slot.onclick = () => selectItem(item);
                } else {
                    slot.className += ' empty';
                    slot.innerHTML = `
                        <div class="item-icon">ğŸ“¦</div>
                        <div class="item-name">ç©º</div>
                    `;
                }

                itemGrid.appendChild(slot);
            }

            modal.classList.add('show');
        }

        function closeItemModal() {
            const modal = document.getElementById('itemModal');
            modal.classList.remove('show');
            selectedItem = null;
        }

        function selectItem(item) {
            if (item.count > 0) {
                selectedItem = item;
                showUseConfirm(item);
            }
        }

        function showUseConfirm(item) {
            const confirmModal = document.getElementById('useConfirm');
            const confirmText = document.getElementById('confirmText');

            confirmText.textContent = `${item.name}ã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ\nåŠ¹æœ: ${item.effect}`;
            confirmModal.classList.add('show');
        }

        function confirmUse(useItem) {
            const confirmModal = document.getElementById('useConfirm');
            confirmModal.classList.remove('show');

            if (useItem && selectedItem) {
                // ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨å‡¦ç†
                useSelectedItem(selectedItem);
            }

            selectedItem = null;
        }

        function useSelectedItem(item) {
            console.log(`${item.name}ã‚’ä½¿ç”¨ã—ã¾ã—ãŸï¼`);

            // ã‚¢ã‚¤ãƒ†ãƒ æ•°ã‚’æ¸›ã‚‰ã™
            item.count--;

            // ã‚¢ã‚¤ãƒ†ãƒ åŠ¹æœã®å‡¦ç†ã‚’ã“ã“ã«å®Ÿè£…
            alert(`${item.name}ã‚’ä½¿ç”¨ã—ã¾ã—ãŸï¼\nåŠ¹æœ: ${item.effect}`);

            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            closeItemModal();

            // å®Ÿéš›ã®ã‚²ãƒ¼ãƒ ã§ã¯æˆ¦é—˜ç”»é¢ã«æˆ»ã‚‹ã‹ã€åŠ¹æœã‚’é©ç”¨ã™ã‚‹
            // ä¾‹: window.location.href = '/battle-continue';
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.getElementById('itemModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeItemModal();
            }
        });

        document.getElementById('useConfirm').addEventListener('click', function(e) {
            if (e.target === this) {
                confirmUse(false);
            }
        });

        // ESCã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (document.getElementById('useConfirm').classList.contains('show')) {
                    confirmUse(false);
                } else if (document.getElementById('itemModal').classList.contains('show')) {
                    closeItemModal();
                }
            }
        });
    </script>

</body>

</html>