<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>設定</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reset.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/config.css') }}">
</head>

<body>
    <div class="container">
        <div class="background"></div> <!-- 背景用の要素 -->
        <div class="board">
            <p>設定</p>
            <form action="/config" method="post">
                <div class="form-row">
                    <label for="username">ユーザー名：</label>
                    <input type="text" id="username" name="username" required value="{{ user[1] }}">
                </div>

                <div class="form-row">
                    <label>性別：</label>
                    <div id="gender-buttons">
                        <button type="button" onclick="selectGender('man', this)"
                            {% if user[2] == 'male' %}class="selected" {% endif %}>男</button>
                        <button type="button" onclick="selectGender('woman', this)"
                            {% if user[2] == 'female' %}class="selected" {% endif %}>女</button>
                    </div>
                    <input type="hidden" name="gender" id="gender" value="{{ user[2] }}" required>
                </div>

                <div class="form-row">
                    <label for="grade">学年：</label>
                    <select id="grade" name="gradeSetting" required>
                        <option value="" disabled {% if not user[3] %}selected{% endif %}>選択してください</option>
                        {% for n in range(1, 7) %}
                        <option value="{{ n }}" {% if user[3] == n %}selected{% endif %}>{{ n }}年生</option>
                        {% endfor %}
                    </select>
                </div>

                <button type="submit">変更</button>
            </form>

            <form action="/config" method="post" class="logout-form">
                <button type="submit" class="btn-logout">ログアウト</button>
            </form>

            <button type="button" class="btn-back" onclick="history.back()">◀ 戻る</button>
        </div>
    </div>

    <script>
        function selectGender(value, button) {
            document.getElementById('gender').value = value;
            const buttons = document.querySelectorAll('#gender-buttons button');
            buttons.forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
        }

        window.onload = function () {
            console.log('window.onload fired');
            const gender = document.getElementById('gender').value;
            console.log('gender:', gender);
            if (gender) {
                const button = document.querySelector(`#gender-buttons button[onclick*="${gender}"]`);
                console.log('button found:', button);
                if (button) {
                    selectGender(gender, button);
                }
            }
        };
    </script>
</body>

</html>